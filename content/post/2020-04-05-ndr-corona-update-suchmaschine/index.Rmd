---
title: NDR Corona Update Suchmaschine
author: Urs Wilke
date: '2020-04-05'
slug: []
categories: []
tags:
  - NDR
  - Corona
  - Drosten
  - DT
  - datatable
subtitle: ''
summary: ''
authors: []
lastmod: '2020-04-05T11:35:09+02:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



```{r libs, include=FALSE}
# knitr::opts_chunk$set(cache = TRUE)
library(tidyverse)
# library(pdftools)
library(rvest)

```


```{r mainsite, include=FALSE}
ndr_site <-   "https://www.ndr.de/nachrichten/info/Coronavirus-Update-Die-Podcast-Folgen-als-Skript,podcastcoronavirus102.html"
all_links <-
  ndr_site %>%
  read_html()

```



```{r rvest, include=FALSE}
a_links <- 
  all_links %>%
  html_nodes("h2 a")
Datum <- 
  all_links %>%
  html_nodes(".date") %>% 
  html_text()

# Themen <- 
#   all_links %>%
#   html_nodes("p") %>%
#   html_text() %>% 
#   .[3:15]
  # str_subset("^\nThemen")

# # episodes <-
# ndr_site %>%
#   read_html() %>%
#   html_nodes("p")
# 
links <-
  a_links %>% html_attr("href")

```


```{r all_link_data, include=FALSE}
pdf_links <-
  links %>%
  url_absolute(ndr_site) %>%
  set_names(a_links %>% html_text()) %>%
  enframe(name = "Titel", value = "url") %>%
  filter(str_detect(url, "\\.pdf$") & (!str_detect(Titel, "^Download"))) %>% 
  mutate(
    Datum#, 
    # Themen
    ) %>% 
  mutate_all(~str_remove_all(., "\n"))


# walk2(pdf_links$Titel, 
#       pdf_links$url,
#       ~download.file(.y, paste0("data/", .x)))

```


```{r download_pdfs, include=FALSE}
all_pdfs <- 
  pdf_links %>% 
  mutate(text = map(url, ~tabulizer::extract_text(.x))) %>% 
  unnest(text)

```


```{r resulting_table, include=FALSE}
df_saetze <- 
  all_pdfs %>% 
  mutate(i = row_number()) %>% 
  tidytext::unnest_tokens(Satz, 
                          text,
                          "sentences",
                          to_lower = FALSE) %>%  
  group_by(Titel) %>% 
  mutate(`Satz-Nr.` = row_number()) %>% 
  arrange(i, `Satz-Nr.`) %>% 
  mutate(`Satz-Nr.` = paste0(`Satz-Nr.`, "/", n())) %>% 
  ungroup() %>% 
  select(-i)


df_saetze <- 
  all_pdfs %>% 
  separate_rows(text, sep = "\n") %>% 
  group_by(url) %>%  
  mutate(i = case_when(str_detect(text %>% str_to_lower(), "^christian drosten$") ~ "cd",
                       str_detect(text %>% str_to_lower(), "^korinna hennig$")    ~ "kh",
                       str_detect(text %>% str_to_lower(), "^anja martini$")      ~ "am")
         ) %>%
  mutate(Absatz = cumsum(!is.na(i))) %>%  
  fill(i) %>% 
  group_by_at(c("Titel", "url", "Datum", 
                # "Themen", 
                "Absatz")) %>% 
  summarise(Person = unique(i),
            text = paste(text, collapse = "\n")) %>%
  tidytext::unnest_tokens(Satz, 
                          text,
                          "sentences",
                          to_lower = FALSE) %>% 
  mutate(Seite = str_extract(Satz, "\\d+\\/\\d+")) %>% 
  fill(Seite) %>% 
  ungroup()


# write_csv(df_saetze, "drosten.csv")

```


```{r save_excel, include=FALSE}
# openxlsx::write.xlsx(df_saetze, "drosten.xlsx", firstRow = TRUE)

```

Hier ist eine tabellarische Übersicht der Skripte der täglichen Coronavirus-Update-Podcast-Folgen des NDR mit Prof. Dr. Christian Drosten, Leiter der Virologie an der Berliner Charité. 

Die Podcasts sind auf 

https://www.youtube.com/playlist?list=PLkKON9te6p3OpxqDskVsxXOmhfW0uPi1H

Die dazugehörigen Skripte sind auf:

https://www.ndr.de/nachrichten/info/Coronavirus-Update-Die-Podcast-Folgen-als-Skript,podcastcoronavirus102.html

In der Tabelle unten sind schlicht die Texte aus allen PDFs aufgeführt. Jeder Satz aus den PDFs entspricht einer Zeile in der Tabelle. Daneben habe ich den Tabellen das Datum der Folge aufgeführt. Weiter können über den Button "column visibility" die url des jeweiligen PDFs, der Titel der Folge, die Seite im PDF, die Nummer des Absatzes im pdf und die Person die spricht eingeblendet werden.

Über die Suchfelder können die Texte gefiltert werden. 

Als Beispiel: Wenn man "test labor" (ohne Anführungszeichen) im Suchfeld ("Search") eingibt, werden alle Sätze angezeigt, die diese beiden Wortbestandteile enthalten.

Unter der Tabelle sind weitere Optionen zum Filtern der Tabelleneinträge.



```{r datatable, include=FALSE}

d <- df_saetze %>% 
    select(Satz, Datum, url, everything()#, 
           # -Titel,
           # -Themen
           ) %>%
  # select(Datum, `Satz-Nr.`, Satz) %>% 
  DT::datatable(filter = "top", 
                rownames = FALSE,
                options = list(
                  columnDefs = list(list(visible=FALSE, targets=2:6)),
                  dom = 'BfrtipP',
                  # see https://rstudio.github.io/DT/extensions.html
                  searchPanes = list(show = FALSE),
                  targets = c(1),
                  scrollX = TRUE,
                  buttons = list(list(
                    extend = 'colvis', columns = c(1:6)
                  ))#,
                  # fixedColumns = TRUE
  ),
  extensions = c('Buttons', 'Select', 'SearchPanes'),
  selection = 'none')
```


```{r widgetframe, message=FALSE}
widgetframe::frameWidget(d, height = 3000, width = '100%')
```

